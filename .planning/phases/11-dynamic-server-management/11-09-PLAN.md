---
phase: 11-dynamic-server-management
plan: 09
type: execute
wave: 4
depends_on: ["11-06", "11-07", "11-08"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can add new FTP server through UI and it deploys within 30 seconds"
    - "User can add new SFTP server through UI with custom configuration"
    - "User can add new NAS server through UI and it appears in ConfigMap"
    - "User can remove server through UI and resources are deleted within 60 seconds"
    - "All dynamically created resources have ownerReferences"
    - "User can export configuration to JSON file downloadable from browser"
    - "User can import configuration and simulator recreates servers automatically"
    - "ConfigMap updates when servers added/removed"
  artifacts: []
  key_links: []
---

<objective>
Human verification of Phase 11 dynamic server management functionality.

Purpose: Verify all server lifecycle operations work correctly before marking phase complete.
Output: Verification confirmation or issues for gap closure.
</objective>

<execution_context>
@C:\Users\UserC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\UserC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-dynamic-server-management/11-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deploy updated Control API and rebuild dashboard</name>
  <files></files>
  <action>
1. Update RBAC by redeploying Helm chart:
```bash
helm upgrade --install file-sim ./helm-chart/file-simulator \
    --kube-context=file-simulator \
    --namespace file-simulator
```

2. Rebuild and push Control API image:
```bash
cd src/FileSimulator.ControlApi
docker build -t file-simulator-control-api:latest .
minikube -p file-simulator image load file-simulator-control-api:latest
```

3. Restart Control API to pick up new image:
```bash
kubectl --context=file-simulator rollout restart deployment file-sim-file-simulator-control-api -n file-simulator
```

4. Wait for pod to be ready:
```bash
kubectl --context=file-simulator wait --for=condition=ready pod -l app.kubernetes.io/component=control-api -n file-simulator --timeout=60s
```

5. Rebuild dashboard:
```bash
cd src/dashboard
npm run build
npm run preview
```
  </action>
  <verify>
- Helm upgrade succeeds
- Control API pod running with new image
- Dashboard accessible at localhost
- No console errors
  </verify>
  <done>Control API and dashboard deployed with Phase 11 features.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify Dynamic Server Management</name>
  <what-built>
Complete dynamic server management with:
- Add Server modal (FTP, SFTP, NAS)
- Delete server with confirmation
- Multi-select batch delete
- Start/stop/restart lifecycle operations
- Configuration export/import
- Settings panel
  </what-built>
  <how-to-verify>

**Prerequisites:**
- Dashboard open at http://localhost:5173 (or preview port)
- Minikube file-simulator profile running

**Test 1: Create FTP Server**
1. Click "+ Add Server" in header
2. Select FTP protocol
3. Enter name: `test-ftp-1`
4. Enter username: `testuser`
5. Enter password: `testpass123`
6. Click "Create Server"
7. Wait for progress to show "Complete"
8. Verify server appears in grid with "Dynamic" badge

**Test 2: Create SFTP Server**
1. Click "+ Add Server"
2. Select SFTP protocol
3. Enter name: `test-sftp-1`
4. Enter username: `sftpuser`
5. Enter password: `sftppass123`
6. Click "Create Server"
7. Verify server appears with "Dynamic" badge

**Test 3: Create NAS Server**
1. Click "+ Add Server"
2. Select NAS protocol
3. Enter name: `test-nas-1`
4. Select "Input Directory" preset
5. Click "Create Server"
6. Verify server appears with "Dynamic" badge

**Test 4: Verify Kubernetes Resources**
```bash
# Verify deployments created with ownerReferences
kubectl --context=file-simulator get deployments -n file-simulator | grep test-

# Check ownerReferences (should point to control-api pod)
kubectl --context=file-simulator get deployment file-sim-file-simulator-ftp-test-ftp-1 -o jsonpath='{.metadata.ownerReferences}' -n file-simulator

# Verify ConfigMap updated
kubectl --context=file-simulator get configmap file-sim-file-simulator-endpoints -o yaml -n file-simulator | grep test-
```

**Test 5: Delete Single Server**
1. Hover over `test-ftp-1` card
2. Click trash icon
3. Confirm deletion in dialog
4. Verify server disappears from grid

```bash
# Verify resources deleted
kubectl --context=file-simulator get all -n file-simulator | grep test-ftp-1
# Should return nothing
```

**Test 6: Multi-Select Batch Delete**
1. Click checkbox on `test-sftp-1` card
2. Click checkbox on `test-nas-1` card
3. Batch operations bar should appear showing "2 servers selected"
4. Click "Delete (2)"
5. Confirm in dialog
6. Verify both servers disappear

**Test 7: Server Lifecycle (Start/Stop/Restart)**
1. Create a new server: `test-lifecycle-1`
2. Click on server card to open details panel
3. (If lifecycle buttons exist in panel) Click Stop
4. Verify server status changes
5. Click Start
6. Verify server comes back online
7. Click Restart
8. Verify server restarts (brief offline then back online)

**Test 8: Configuration Export**
1. Click Settings (gear icon in header)
2. Click "Export Configuration"
3. Verify JSON file downloads
4. Open file and verify it contains both static and dynamic servers

**Test 9: Configuration Import**
1. Create test server: `import-test-1`
2. Export configuration
3. Delete `import-test-1` server
4. Click Settings -> Import Configuration
5. Select the exported file
6. Preview should show `import-test-1` will be created
7. Click Import
8. Verify `import-test-1` is recreated

**Test 10: Static Server Protection**
1. Find a static server (e.g., the original FTP server)
2. Verify it shows "Helm" badge (not "Dynamic")
3. Verify NO delete button appears on hover
4. Verify checkbox is NOT shown for static servers

**Expected Results:**
- All 10 tests pass
- Servers deploy within 30 seconds
- Servers delete within 60 seconds
- ownerReferences point to control-api pod
- ConfigMap updates automatically
- Static servers protected from deletion

  </how-to-verify>
  <resume-signal>
Reply with test results:
- "UAT passed" if all tests pass
- Or describe which tests failed with details
  </resume-signal>
</task>

</tasks>

<verification>
Human verification confirms:
1. Server creation works (FTP, SFTP, NAS)
2. Server deletion works (single and batch)
3. ownerReferences correctly set
4. ConfigMap updates
5. Export/import functionality
6. Static server protection
</verification>

<success_criteria>
All 10 verification tests pass, demonstrating:
- CTRL-01/02/03: Add FTP/SFTP/NAS servers at runtime
- CTRL-04/05: Delete with cleanup and ownerReferences
- CTRL-06: ConfigMap updates
- CTRL-07: Lifecycle management (if implemented in UI)
- CFG-01/02/03: Export/import with validation
</success_criteria>

<output>
After completion, create `.planning/phases/11-dynamic-server-management/11-09-SUMMARY.md`

If tests fail, create `.planning/phases/11-dynamic-server-management/11-UAT.md` with failed tests for gap closure.
</output>
