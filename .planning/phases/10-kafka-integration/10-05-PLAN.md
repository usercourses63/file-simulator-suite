---
phase: 10-kafka-integration
plan: 05
type: execute
wave: 3
depends_on: ["10-04"]
files_modified:
  - src/dashboard/src/components/TopicList.tsx
  - src/dashboard/src/components/CreateTopicForm.tsx
  - src/dashboard/src/components/MessageProducer.tsx
  - src/dashboard/src/components/KafkaTab.tsx
  - src/dashboard/src/components/KafkaTab.css
autonomous: true

must_haves:
  truths:
    - "User can see topic list with create button"
    - "User can create a topic with name and partitions"
    - "User can delete a topic with confirmation"
    - "User can produce a message with optional key"
    - "Produced message shows success feedback"
  artifacts:
    - path: "src/dashboard/src/components/TopicList.tsx"
      provides: "Topic list with CRUD operations"
      contains: "deleteTopic"
    - path: "src/dashboard/src/components/CreateTopicForm.tsx"
      provides: "Topic creation modal/form"
      contains: "CreateTopicRequest"
    - path: "src/dashboard/src/components/MessageProducer.tsx"
      provides: "Message production form"
      contains: "produceMessage"
  key_links:
    - from: "TopicList.tsx"
      to: "useKafka hook"
      via: "props from KafkaTab"
      pattern: "deleteTopic"
    - from: "MessageProducer.tsx"
      to: "useKafka hook"
      via: "props from KafkaTab"
      pattern: "produceMessage"
---

<objective>
Implement topic management UI and message producer functionality

Purpose: Enable users to create/delete topics and produce test messages through the dashboard
Output: TopicList, CreateTopicForm, and MessageProducer components integrated into KafkaTab
</objective>

<execution_context>
@C:\Users\UserC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\UserC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-kafka-integration/10-CONTEXT.md
@src/dashboard/src/components/KafkaTab.tsx
@src/dashboard/src/hooks/useKafka.ts
@src/dashboard/src/types/kafka.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TopicList component with delete functionality</name>
  <files>src/dashboard/src/components/TopicList.tsx</files>
  <action>
Create TopicList component that displays topics with selection and delete capability.

```tsx
import { useState } from 'react';
import type { TopicInfo } from '../types/kafka';

interface TopicListProps {
  topics: TopicInfo[];
  selectedTopic: string | null;
  onSelectTopic: (topic: string | null) => void;
  onDeleteTopic: (name: string) => Promise<void>;
  onCreateClick: () => void;
}

function TopicList({
  topics,
  selectedTopic,
  onSelectTopic,
  onDeleteTopic,
  onCreateClick
}: TopicListProps) {
  const [deletingTopic, setDeletingTopic] = useState<string | null>(null);
  const [confirmDelete, setConfirmDelete] = useState<string | null>(null);

  const handleDelete = async (name: string) => {
    setDeletingTopic(name);
    try {
      await onDeleteTopic(name);
      if (selectedTopic === name) {
        onSelectTopic(null);
      }
    } catch (err) {
      console.error('Failed to delete topic:', err);
      alert(`Failed to delete topic: ${err instanceof Error ? err.message : 'Unknown error'}`);
    } finally {
      setDeletingTopic(null);
      setConfirmDelete(null);
    }
  };

  return (
    <div className="topic-list">
      <header className="topic-list__header">
        <h3>Topics</h3>
        <button
          className="topic-list__create-btn"
          onClick={onCreateClick}
          type="button"
        >
          + Create Topic
        </button>
      </header>

      {topics.length === 0 ? (
        <div className="topic-list__empty">
          No topics found. Create one to get started.
        </div>
      ) : (
        <ul className="topic-list__items">
          {topics.map(topic => (
            <li
              key={topic.name}
              className={`topic-list__item ${selectedTopic === topic.name ? 'topic-list__item--selected' : ''}`}
            >
              <button
                className="topic-list__item-btn"
                onClick={() => onSelectTopic(selectedTopic === topic.name ? null : topic.name)}
                type="button"
              >
                <span className="topic-list__item-name">{topic.name}</span>
                <span className="topic-list__item-info">
                  {topic.partitionCount} partition{topic.partitionCount !== 1 ? 's' : ''}
                </span>
              </button>

              {confirmDelete === topic.name ? (
                <div className="topic-list__confirm">
                  <span>Delete?</span>
                  <button
                    className="topic-list__confirm-yes"
                    onClick={() => handleDelete(topic.name)}
                    disabled={deletingTopic === topic.name}
                    type="button"
                  >
                    {deletingTopic === topic.name ? '...' : 'Yes'}
                  </button>
                  <button
                    className="topic-list__confirm-no"
                    onClick={() => setConfirmDelete(null)}
                    type="button"
                  >
                    No
                  </button>
                </div>
              ) : (
                <button
                  className="topic-list__delete-btn"
                  onClick={(e) => {
                    e.stopPropagation();
                    setConfirmDelete(topic.name);
                  }}
                  title="Delete topic"
                  type="button"
                >
                  ×
                </button>
              )}
            </li>
          ))}
        </ul>
      )}
    </div>
  );
}

export default TopicList;
```
  </action>
  <verify>
`npm run build --prefix src/dashboard` type-checks without errors
  </verify>
  <done>
TopicList shows topics with selection highlighting, delete confirmation, and create button
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CreateTopicForm modal component</name>
  <files>src/dashboard/src/components/CreateTopicForm.tsx</files>
  <action>
Create modal form for topic creation with name and partition count inputs.

```tsx
import { useState } from 'react';
import type { CreateTopicRequest } from '../types/kafka';

interface CreateTopicFormProps {
  onSubmit: (request: CreateTopicRequest) => Promise<void>;
  onCancel: () => void;
}

function CreateTopicForm({ onSubmit, onCancel }: CreateTopicFormProps) {
  const [name, setName] = useState('');
  const [partitions, setPartitions] = useState(1);
  const [submitting, setSubmitting] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError(null);

    // Validate
    if (!name.trim()) {
      setError('Topic name is required');
      return;
    }
    if (!/^[a-zA-Z0-9._-]+$/.test(name)) {
      setError('Topic name can only contain letters, numbers, dots, underscores, and hyphens');
      return;
    }
    if (partitions < 1 || partitions > 100) {
      setError('Partitions must be between 1 and 100');
      return;
    }

    setSubmitting(true);
    try {
      await onSubmit({
        name: name.trim(),
        partitions,
        replicationFactor: 1  // Single broker, always 1
      });
      onCancel();  // Close form on success
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to create topic');
    } finally {
      setSubmitting(false);
    }
  };

  return (
    <div className="create-topic-overlay" onClick={onCancel}>
      <form
        className="create-topic-form"
        onClick={e => e.stopPropagation()}
        onSubmit={handleSubmit}
      >
        <header className="create-topic-form__header">
          <h3>Create Topic</h3>
          <button
            type="button"
            className="create-topic-form__close"
            onClick={onCancel}
          >
            ×
          </button>
        </header>

        {error && (
          <div className="create-topic-form__error">
            {error}
          </div>
        )}

        <div className="create-topic-form__field">
          <label htmlFor="topic-name">Topic Name</label>
          <input
            id="topic-name"
            type="text"
            value={name}
            onChange={e => setName(e.target.value)}
            placeholder="e.g., my-topic"
            autoFocus
            disabled={submitting}
          />
          <span className="create-topic-form__hint">
            Letters, numbers, dots, underscores, hyphens
          </span>
        </div>

        <div className="create-topic-form__field">
          <label htmlFor="topic-partitions">Partitions</label>
          <input
            id="topic-partitions"
            type="number"
            min={1}
            max={100}
            value={partitions}
            onChange={e => setPartitions(parseInt(e.target.value) || 1)}
            disabled={submitting}
          />
          <span className="create-topic-form__hint">
            More partitions = more parallelism (1-100)
          </span>
        </div>

        <footer className="create-topic-form__footer">
          <button
            type="button"
            className="create-topic-form__cancel"
            onClick={onCancel}
            disabled={submitting}
          >
            Cancel
          </button>
          <button
            type="submit"
            className="create-topic-form__submit"
            disabled={submitting}
          >
            {submitting ? 'Creating...' : 'Create Topic'}
          </button>
        </footer>
      </form>
    </div>
  );
}

export default CreateTopicForm;
```
  </action>
  <verify>
`npm run build --prefix src/dashboard` type-checks without errors
  </verify>
  <done>
CreateTopicForm modal allows topic creation with validation and loading state
  </done>
</task>

<task type="auto">
  <name>Task 3: Create MessageProducer component and update KafkaTab</name>
  <files>
src/dashboard/src/components/MessageProducer.tsx
src/dashboard/src/components/KafkaTab.tsx
src/dashboard/src/components/KafkaTab.css
  </files>
  <action>
**Create MessageProducer.tsx:**

```tsx
import { useState } from 'react';
import type { ProduceMessageRequest, ProduceMessageResult } from '../types/kafka';

interface MessageProducerProps {
  topic: string;
  onProduce: (request: ProduceMessageRequest) => Promise<ProduceMessageResult>;
}

function MessageProducer({ topic, onProduce }: MessageProducerProps) {
  const [key, setKey] = useState('');
  const [value, setValue] = useState('');
  const [sending, setSending] = useState(false);
  const [result, setResult] = useState<ProduceMessageResult | null>(null);
  const [error, setError] = useState<string | null>(null);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!value.trim()) {
      setError('Message body is required');
      return;
    }

    setError(null);
    setResult(null);
    setSending(true);

    try {
      const res = await onProduce({
        topic,
        key: key.trim() || null,
        value: value.trim()
      });
      setResult(res);
      setValue('');  // Clear message after success
      // Keep key for convenience (often same key for related messages)
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to send message');
    } finally {
      setSending(false);
    }
  };

  return (
    <div className="message-producer">
      <h4 className="message-producer__title">
        Produce Message to "{topic}"
      </h4>

      <form className="message-producer__form" onSubmit={handleSubmit}>
        <div className="message-producer__field">
          <label htmlFor="msg-key">Key (optional)</label>
          <input
            id="msg-key"
            type="text"
            value={key}
            onChange={e => setKey(e.target.value)}
            placeholder="Message key for partitioning"
            disabled={sending}
          />
        </div>

        <div className="message-producer__field">
          <label htmlFor="msg-value">Message Body</label>
          <textarea
            id="msg-value"
            value={value}
            onChange={e => setValue(e.target.value)}
            placeholder="Enter message content (any string)"
            rows={4}
            disabled={sending}
          />
        </div>

        {error && (
          <div className="message-producer__error">{error}</div>
        )}

        {result && (
          <div className="message-producer__success">
            Sent to partition {result.partition} @ offset {result.offset}
          </div>
        )}

        <button
          type="submit"
          className="message-producer__submit"
          disabled={sending || !value.trim()}
        >
          {sending ? 'Sending...' : 'Send Message'}
        </button>
      </form>
    </div>
  );
}

export default MessageProducer;
```

**Update KafkaTab.tsx to integrate new components:**

```tsx
import { useState } from 'react';
import { useKafka } from '../hooks/useKafka';
import { getLagLevel } from '../types/kafka';
import TopicList from './TopicList';
import CreateTopicForm from './CreateTopicForm';
import MessageProducer from './MessageProducer';
import './KafkaTab.css';

interface KafkaTabProps {
  apiBaseUrl: string;
}

function KafkaTab({ apiBaseUrl }: KafkaTabProps) {
  const {
    topics,
    topicsLoading,
    topicsError,
    createTopic,
    deleteTopic,
    consumerGroups,
    groupsLoading,
    groupsError,
    produceMessage,
    isHealthy
  } = useKafka({ apiBaseUrl });

  const [selectedTopic, setSelectedTopic] = useState<string | null>(null);
  const [showCreateForm, setShowCreateForm] = useState(false);

  return (
    <div className="kafka-tab">
      {/* Health Status */}
      <div className="kafka-health">
        <span className={`kafka-health__indicator kafka-health__indicator--${isHealthy ? 'healthy' : isHealthy === false ? 'unhealthy' : 'unknown'}`} />
        <span className="kafka-health__label">
          Kafka: {isHealthy ? 'Connected' : isHealthy === false ? 'Disconnected' : 'Checking...'}
        </span>
      </div>

      <div className="kafka-layout">
        {/* Left: Topics */}
        <div className="kafka-panel kafka-panel--topics">
          {topicsLoading ? (
            <div className="kafka-loading">Loading topics...</div>
          ) : topicsError ? (
            <div className="kafka-error">{topicsError}</div>
          ) : (
            <TopicList
              topics={topics}
              selectedTopic={selectedTopic}
              onSelectTopic={setSelectedTopic}
              onDeleteTopic={deleteTopic}
              onCreateClick={() => setShowCreateForm(true)}
            />
          )}
        </div>

        {/* Center: Message Producer (when topic selected) */}
        <div className="kafka-panel kafka-panel--producer">
          {selectedTopic ? (
            <MessageProducer
              topic={selectedTopic}
              onProduce={produceMessage}
            />
          ) : (
            <div className="kafka-placeholder">
              Select a topic to produce messages
            </div>
          )}
        </div>

        {/* Right: Consumer Groups */}
        <div className="kafka-panel kafka-panel--groups">
          <h3>Consumer Groups</h3>
          {groupsLoading ? (
            <div className="kafka-loading">Loading groups...</div>
          ) : groupsError ? (
            <div className="kafka-error">{groupsError}</div>
          ) : consumerGroups.length === 0 ? (
            <div className="kafka-empty">No consumer groups</div>
          ) : (
            <ul className="kafka-group-list">
              {consumerGroups.map(group => (
                <li key={group.groupId} className="kafka-group-item">
                  <span className="kafka-group-item__id">{group.groupId}</span>
                  <span className="kafka-group-item__state">{group.state}</span>
                  <span className="kafka-group-item__members">{group.memberCount} members</span>
                  <span className={`kafka-group-item__lag kafka-group-item__lag--${getLagLevel(group.totalLag)}`}>
                    Lag: {group.totalLag}
                  </span>
                </li>
              ))}
            </ul>
          )}
        </div>
      </div>

      {/* Create Topic Modal */}
      {showCreateForm && (
        <CreateTopicForm
          onSubmit={createTopic}
          onCancel={() => setShowCreateForm(false)}
        />
      )}
    </div>
  );
}

export default KafkaTab;
```

**Create KafkaTab.css (separate file for Kafka-specific styles):**

```css
/* KafkaTab Layout */
.kafka-tab {
  padding: var(--spacing-lg);
  height: 100%;
  display: flex;
  flex-direction: column;
}

.kafka-health {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-lg);
  padding: var(--spacing-md);
  background: var(--bg-secondary);
  border-radius: var(--border-radius);
}

.kafka-health__indicator {
  width: 12px;
  height: 12px;
  border-radius: 50%;
}

.kafka-health__indicator--healthy { background: var(--color-success); }
.kafka-health__indicator--unhealthy { background: var(--color-error); }
.kafka-health__indicator--unknown { background: var(--color-warning); }

.kafka-layout {
  display: grid;
  grid-template-columns: 280px 1fr 280px;
  gap: var(--spacing-lg);
  flex: 1;
  min-height: 0;
}

@media (max-width: 1024px) {
  .kafka-layout {
    grid-template-columns: 1fr;
  }
}

.kafka-panel {
  background: var(--bg-secondary);
  border-radius: var(--border-radius);
  padding: var(--spacing-md);
  overflow-y: auto;
}

.kafka-loading,
.kafka-error,
.kafka-empty,
.kafka-placeholder {
  padding: var(--spacing-lg);
  text-align: center;
  color: var(--text-secondary);
}

.kafka-error { color: var(--color-error); }

/* Topic List */
.topic-list__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-md);
}

.topic-list__header h3 {
  margin: 0;
  font-size: 1rem;
}

.topic-list__create-btn {
  padding: var(--spacing-xs) var(--spacing-sm);
  font-size: 0.85rem;
  background: var(--color-primary);
  color: white;
  border: none;
  border-radius: var(--border-radius-sm);
  cursor: pointer;
}

.topic-list__create-btn:hover {
  opacity: 0.9;
}

.topic-list__items {
  list-style: none;
  padding: 0;
  margin: 0;
}

.topic-list__item {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-xs);
  border-radius: var(--border-radius-sm);
  background: var(--bg-tertiary);
}

.topic-list__item--selected {
  background: var(--color-primary);
  color: white;
}

.topic-list__item-btn {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  padding: var(--spacing-sm);
  background: none;
  border: none;
  cursor: pointer;
  color: inherit;
  text-align: left;
}

.topic-list__item-name {
  font-weight: 500;
}

.topic-list__item-info {
  font-size: 0.8rem;
  opacity: 0.7;
}

.topic-list__delete-btn {
  padding: var(--spacing-sm);
  background: none;
  border: none;
  color: var(--color-error);
  cursor: pointer;
  font-size: 1.2rem;
  opacity: 0.5;
}

.topic-list__delete-btn:hover {
  opacity: 1;
}

.topic-list__confirm {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs);
  font-size: 0.85rem;
}

.topic-list__confirm-yes,
.topic-list__confirm-no {
  padding: 2px 8px;
  border: none;
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  font-size: 0.8rem;
}

.topic-list__confirm-yes {
  background: var(--color-error);
  color: white;
}

.topic-list__confirm-no {
  background: var(--bg-tertiary);
}

/* Message Producer */
.message-producer {
  height: 100%;
  display: flex;
  flex-direction: column;
}

.message-producer__title {
  margin: 0 0 var(--spacing-md) 0;
  font-size: 1rem;
}

.message-producer__form {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
  flex: 1;
}

.message-producer__field {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.message-producer__field label {
  font-size: 0.85rem;
  font-weight: 500;
}

.message-producer__field input,
.message-producer__field textarea {
  padding: var(--spacing-sm);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius-sm);
  background: var(--bg-tertiary);
  color: var(--text-primary);
  font-family: inherit;
}

.message-producer__field textarea {
  resize: vertical;
  min-height: 100px;
}

.message-producer__error {
  padding: var(--spacing-sm);
  background: rgba(239, 68, 68, 0.1);
  border-radius: var(--border-radius-sm);
  color: var(--color-error);
  font-size: 0.85rem;
}

.message-producer__success {
  padding: var(--spacing-sm);
  background: rgba(34, 197, 94, 0.1);
  border-radius: var(--border-radius-sm);
  color: var(--color-success);
  font-size: 0.85rem;
}

.message-producer__submit {
  padding: var(--spacing-sm) var(--spacing-md);
  background: var(--color-primary);
  color: white;
  border: none;
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  font-weight: 500;
}

.message-producer__submit:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Consumer Groups */
.kafka-group-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.kafka-group-item {
  display: flex;
  flex-direction: column;
  gap: 4px;
  padding: var(--spacing-sm);
  margin-bottom: var(--spacing-xs);
  background: var(--bg-tertiary);
  border-radius: var(--border-radius-sm);
}

.kafka-group-item__id {
  font-weight: 500;
  word-break: break-all;
}

.kafka-group-item__state,
.kafka-group-item__members {
  font-size: 0.8rem;
  color: var(--text-secondary);
}

.kafka-group-item__lag {
  display: inline-block;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.8rem;
  width: fit-content;
}

.kafka-group-item__lag--green {
  background: rgba(34, 197, 94, 0.2);
  color: var(--color-success);
}

.kafka-group-item__lag--yellow {
  background: rgba(234, 179, 8, 0.2);
  color: var(--color-warning);
}

.kafka-group-item__lag--red {
  background: rgba(239, 68, 68, 0.2);
  color: var(--color-error);
}

/* Create Topic Modal */
.create-topic-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.create-topic-form {
  background: var(--bg-primary);
  border-radius: var(--border-radius);
  padding: var(--spacing-lg);
  width: 400px;
  max-width: 90vw;
}

.create-topic-form__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-md);
}

.create-topic-form__header h3 {
  margin: 0;
}

.create-topic-form__close {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--text-secondary);
}

.create-topic-form__error {
  padding: var(--spacing-sm);
  margin-bottom: var(--spacing-md);
  background: rgba(239, 68, 68, 0.1);
  border-radius: var(--border-radius-sm);
  color: var(--color-error);
  font-size: 0.85rem;
}

.create-topic-form__field {
  margin-bottom: var(--spacing-md);
}

.create-topic-form__field label {
  display: block;
  margin-bottom: var(--spacing-xs);
  font-weight: 500;
}

.create-topic-form__field input {
  width: 100%;
  padding: var(--spacing-sm);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius-sm);
  background: var(--bg-secondary);
  color: var(--text-primary);
}

.create-topic-form__hint {
  display: block;
  margin-top: 4px;
  font-size: 0.8rem;
  color: var(--text-secondary);
}

.create-topic-form__footer {
  display: flex;
  justify-content: flex-end;
  gap: var(--spacing-sm);
  margin-top: var(--spacing-lg);
}

.create-topic-form__cancel,
.create-topic-form__submit {
  padding: var(--spacing-sm) var(--spacing-md);
  border: none;
  border-radius: var(--border-radius-sm);
  cursor: pointer;
}

.create-topic-form__cancel {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

.create-topic-form__submit {
  background: var(--color-primary);
  color: white;
}

.create-topic-form__submit:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
```

**Update App.css to remove duplicate Kafka styles** (remove the Kafka styles added in Plan 04 since they're now in KafkaTab.css).
  </action>
  <verify>
`npm run build --prefix src/dashboard` builds without errors and topic management works
  </verify>
  <done>
TopicList shows topics with create/delete, CreateTopicForm modal works, MessageProducer sends messages
  </done>
</task>

</tasks>

<verification>
1. `npm run build --prefix src/dashboard` - builds without errors
2. Topic list displays with create button
3. Create topic modal opens and validates input
4. Delete confirmation appears before deletion
5. Message producer form accepts key and value
6. Success/error feedback displayed after operations
</verification>

<success_criteria>
- TopicList shows all topics with selection state
- Create topic form validates name format and partition range
- Delete requires confirmation before executing
- Message producer accepts optional key and required value
- Feedback shown for all operations (loading, success, error)
- CSS uses existing CSS custom properties for consistency
</success_criteria>

<output>
After completion, create `.planning/phases/10-kafka-integration/10-05-SUMMARY.md`
</output>
