---
phase: 08-file-operations-event-streaming
plan: 05
type: execute
wave: 2
depends_on: ["08-01", "08-03"]
files_modified:
  - src/dashboard/src/components/FileEventFeed.tsx
  - src/dashboard/src/App.tsx
  - src/dashboard/src/App.css
autonomous: true

must_haves:
  truths:
    - "File event feed shows real-time file activity"
    - "Events display type, path, time, and protocol badges"
    - "Feed shows newest events at top with max 50 items"
    - "App.tsx includes FileBrowser and FileEventFeed tabs"
  artifacts:
    - path: "src/dashboard/src/components/FileEventFeed.tsx"
      provides: "Live file event feed component"
      contains: "export function FileEventFeed"
      min_lines: 60
    - path: "src/dashboard/src/App.tsx"
      provides: "Updated app with file browser integration"
      contains: "FileBrowser"
    - path: "src/dashboard/src/App.css"
      provides: "Styles for file components"
      contains: ".file-browser"
      min_lines: 200
  key_links:
    - from: "src/dashboard/src/components/FileEventFeed.tsx"
      to: "useFileEvents"
      via: "hook import and call"
      pattern: "useFileEvents"
    - from: "src/dashboard/src/App.tsx"
      to: "FileBrowser"
      via: "component import and render"
      pattern: "import.*FileBrowser"
---

<objective>
Implement FileEventFeed component, integrate all file components into App.tsx, and add comprehensive CSS styling.

Purpose: Complete the file operations UI with live event streaming and consistent visual styling across all new components.

Output:
- FileEventFeed component for real-time event display
- Updated App.tsx with file browser integration
- App.css extended with file component styles
</objective>

<execution_context>
@C:\Users\UserC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\UserC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-file-operations-event-streaming/08-RESEARCH.md
@.planning/phases/08-file-operations-event-streaming/08-01-SUMMARY.md
@.planning/phases/08-file-operations-event-streaming/08-03-SUMMARY.md
@.planning/phases/08-file-operations-event-streaming/08-04-SUMMARY.md

# Existing frontend
@src/dashboard/src/App.tsx
@src/dashboard/src/App.css
@src/dashboard/src/hooks/useFileEvents.ts
@src/dashboard/src/components/FileBrowser.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FileEventFeed component</name>
  <files>
    src/dashboard/src/components/FileEventFeed.tsx
  </files>
  <action>
Create FileEventFeed.tsx for displaying live file events:

```typescript
import type { FileEvent } from '../types/fileTypes';
import ProtocolBadges from './ProtocolBadges';

interface FileEventFeedProps {
  events: FileEvent[];
  isConnected: boolean;
  onClear?: () => void;
}

// Event type icons
const eventIcons: Record<string, string> = {
  Created: '+',
  Modified: '~',
  Deleted: '-',
  Renamed: '->',
};

// Event type colors (CSS class suffixes)
const eventColors: Record<string, string> = {
  Created: 'created',
  Modified: 'modified',
  Deleted: 'deleted',
  Renamed: 'renamed',
};

// Format time for display
function formatTime(isoDate: string): string {
  try {
    const date = new Date(isoDate);
    return date.toLocaleTimeString();
  } catch {
    return isoDate;
  }
}

// Extract short path for display
function formatPath(event: FileEvent): string {
  const path = event.relativePath || event.fileName;
  if (event.eventType === 'Renamed' && event.oldPath) {
    const oldName = event.oldPath.split(/[/\\]/).pop() || event.oldPath;
    return `${oldName} -> ${event.fileName}`;
  }
  return path;
}

/**
 * Live scrolling feed of file system events.
 * Shows newest events at top, max 50 items.
 */
export function FileEventFeed({ events, isConnected, onClear }: FileEventFeedProps) {
  return (
    <div className="file-event-feed">
      <div className="file-event-feed__header">
        <h3 className="file-event-feed__title">
          File Activity
          <span className={`file-event-feed__status ${isConnected ? 'file-event-feed__status--connected' : ''}`}>
            {isConnected ? 'Live' : 'Disconnected'}
          </span>
        </h3>
        {events.length > 0 && onClear && (
          <button
            className="file-event-feed__clear"
            onClick={onClear}
            type="button"
          >
            Clear
          </button>
        )}
      </div>

      <div className="file-event-feed__list">
        {events.length === 0 ? (
          <div className="file-event-feed__empty">
            {isConnected
              ? 'Waiting for file activity...'
              : 'Connecting to file events...'}
          </div>
        ) : (
          events.map((event, index) => (
            <div
              key={`${event.path}-${event.timestamp}-${index}`}
              className={`file-event-feed__item file-event-feed__item--${eventColors[event.eventType] || 'default'}`}
            >
              <span className="file-event-feed__icon" title={event.eventType}>
                {eventIcons[event.eventType] || '?'}
              </span>

              <span className="file-event-feed__type">
                {event.eventType}
              </span>

              <span className="file-event-feed__path" title={event.path}>
                {event.isDirectory ? 'üìÅ ' : ''}
                {formatPath(event)}
              </span>

              <span className="file-event-feed__time">
                {formatTime(event.timestamp)}
              </span>

              <ProtocolBadges protocols={event.protocols} size="small" />
            </div>
          ))
        )}
      </div>

      <div className="file-event-feed__footer">
        Showing {events.length} of 50 max events
      </div>
    </div>
  );
}

export default FileEventFeed;
```
  </action>
  <verify>
TypeScript compiles:
```powershell
cd src/dashboard
npx tsc --noEmit
```
  </verify>
  <done>FileEventFeed displays events with icons, type, path, time, and protocol badges.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate file components into App.tsx</name>
  <files>
    src/dashboard/src/App.tsx
  </files>
  <action>
Update App.tsx to include file browser and event feed:

1. Add imports:
```typescript
import { useFileEvents } from './hooks/useFileEvents';
import FileBrowser from './components/FileBrowser';
import FileEventFeed from './components/FileEventFeed';
```

2. Add state for active tab:
```typescript
const [activeTab, setActiveTab] = useState<'servers' | 'files'>('servers');
```

3. Add file events connection (similar pattern to status):
```typescript
// Get base URL from env (same as status hub, just different path)
const apiBaseUrl = import.meta.env.VITE_API_BASE_URL || 'http://192.168.49.2:30500';
const fileEventsHubUrl = `${apiBaseUrl}/hubs/fileevents`;

const { events: fileEvents, isConnected: fileEventsConnected, clearEvents } = useFileEvents(fileEventsHubUrl);
```

4. Update header to include tab navigation:
```typescript
<header className="app-header">
  <div className="header-title">
    <h1>File Simulator Suite</h1>
    <nav className="header-tabs">
      <button
        className={`header-tab ${activeTab === 'servers' ? 'header-tab--active' : ''}`}
        onClick={() => setActiveTab('servers')}
      >
        Servers
      </button>
      <button
        className={`header-tab ${activeTab === 'files' ? 'header-tab--active' : ''}`}
        onClick={() => setActiveTab('files')}
      >
        Files
      </button>
    </nav>
  </div>
  <ConnectionStatus ... />
</header>
```

5. Update main content to switch based on tab:
```typescript
<main className="app-main">
  {error && !isReconnecting && (
    <div className="error-banner">...</div>
  )}

  {activeTab === 'servers' && (
    <>
      {data ? (
        <>
          <SummaryHeader servers={data.servers} />
          <ServerGrid servers={data.servers} onCardClick={setSelectedServer} />
        </>
      ) : (
        <div className="loading-state">...</div>
      )}
    </>
  )}

  {activeTab === 'files' && (
    <div className="files-container">
      <div className="files-main">
        <FileBrowser apiBaseUrl={apiBaseUrl} />
      </div>
      <aside className="files-sidebar">
        <FileEventFeed
          events={fileEvents}
          isConnected={fileEventsConnected}
          onClear={clearEvents}
        />
      </aside>
    </div>
  )}
</main>
```

6. Update the panel-open class to not interfere with files tab:
```typescript
<div className={`app ${selectedServer && activeTab === 'servers' ? 'app--panel-open' : ''}`}>
```

Full updated App.tsx preserves all existing functionality while adding file operations tab.
  </action>
  <verify>
Build passes:
```powershell
cd src/dashboard
npm run build
```
  </verify>
  <done>App.tsx has tabbed navigation between Servers and Files views.</done>
</task>

<task type="auto">
  <name>Task 3: Add CSS styles for file components</name>
  <files>
    src/dashboard/src/App.css
  </files>
  <action>
Add styles to App.css for all file-related components. Append to existing styles:

```css
/* =============================================================================
   TAB NAVIGATION
   ============================================================================= */

.header-tabs {
  display: flex;
  gap: 0.5rem;
  margin-left: 1rem;
}

.header-tab {
  padding: 0.5rem 1rem;
  background: transparent;
  border: 1px solid var(--color-border);
  border-radius: 4px;
  color: var(--color-text-secondary);
  cursor: pointer;
  font-size: 0.875rem;
  transition: all 0.2s ease;
}

.header-tab:hover {
  background: var(--color-surface);
  color: var(--color-text);
}

.header-tab--active {
  background: var(--color-primary);
  border-color: var(--color-primary);
  color: white;
}

/* =============================================================================
   FILES LAYOUT
   ============================================================================= */

.files-container {
  display: grid;
  grid-template-columns: 1fr 350px;
  gap: 1rem;
  height: calc(100vh - 120px);
  padding: 1rem;
}

.files-main {
  background: var(--color-surface);
  border-radius: 8px;
  overflow: hidden;
}

.files-sidebar {
  background: var(--color-surface);
  border-radius: 8px;
  overflow: hidden;
}

@media (max-width: 1024px) {
  .files-container {
    grid-template-columns: 1fr;
    grid-template-rows: 1fr auto;
  }

  .files-sidebar {
    max-height: 300px;
  }
}

/* =============================================================================
   FILE BROWSER
   ============================================================================= */

.file-browser {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.file-browser__header {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  border-bottom: 1px solid var(--color-border);
}

.file-browser__title {
  margin: 0;
  font-size: 1.125rem;
  font-weight: 600;
}

.file-browser__breadcrumb {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex: 1;
}

.file-browser__nav-btn {
  padding: 0.25rem 0.5rem;
  background: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: 4px;
  cursor: pointer;
  font-family: monospace;
}

.file-browser__nav-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.file-browser__path {
  font-family: monospace;
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

.file-browser__refresh {
  padding: 0.5rem 1rem;
  background: var(--color-primary);
  border: none;
  border-radius: 4px;
  color: white;
  cursor: pointer;
  font-size: 0.875rem;
}

.file-browser__refresh:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.file-browser__error {
  padding: 0.75rem 1rem;
  background: rgba(239, 68, 68, 0.1);
  border-left: 3px solid #ef4444;
  color: #ef4444;
  font-size: 0.875rem;
}

.file-browser__tree-container {
  flex: 1;
  overflow: auto;
  padding: 0.5rem;
}

.file-browser__loading,
.file-browser__empty {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 200px;
  color: var(--color-text-secondary);
  font-size: 0.875rem;
}

.file-browser__details {
  padding: 1rem;
  border-top: 1px solid var(--color-border);
  background: var(--color-background);
}

.file-browser__details h3 {
  margin: 0 0 0.5rem;
}

.file-browser__details p {
  margin: 0.25rem 0;
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

/* =============================================================================
   FILE TREE
   ============================================================================= */

.file-tree {
  font-size: 0.875rem;
}

.file-tree-node {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0 0.5rem;
  cursor: pointer;
  border-radius: 4px;
}

.file-tree-node:hover {
  background: var(--color-background);
}

.file-tree-node__icon {
  font-size: 1rem;
  flex-shrink: 0;
}

.file-tree-node__name {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.file-tree-node__size {
  font-size: 0.75rem;
  color: var(--color-text-secondary);
  flex-shrink: 0;
  min-width: 60px;
  text-align: right;
}

.file-tree-node__modified {
  font-size: 0.75rem;
  color: var(--color-text-secondary);
  flex-shrink: 0;
  min-width: 80px;
}

.file-tree-node__actions {
  display: flex;
  gap: 0.25rem;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.file-tree-node:hover .file-tree-node__actions {
  opacity: 1;
}

.file-tree-node__action {
  padding: 0.25rem;
  background: transparent;
  border: none;
  cursor: pointer;
  opacity: 0.6;
  font-size: 0.875rem;
}

.file-tree-node__action:hover {
  opacity: 1;
}

.file-tree-node__action--delete:hover {
  color: #ef4444;
}

/* =============================================================================
   FILE UPLOADER
   ============================================================================= */

.file-uploader {
  padding: 1rem;
  border-bottom: 1px solid var(--color-border);
}

.file-uploader__dropzone {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  border: 2px dashed var(--color-border);
  border-radius: 8px;
  background: var(--color-background);
  cursor: pointer;
  transition: all 0.2s ease;
}

.file-uploader__dropzone:hover {
  border-color: var(--color-primary);
  background: rgba(59, 130, 246, 0.05);
}

.file-uploader__dropzone--active {
  border-color: var(--color-primary);
  background: rgba(59, 130, 246, 0.1);
}

.file-uploader__dropzone--disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.file-uploader__text {
  margin: 0;
  color: var(--color-text-secondary);
  text-align: center;
}

.file-uploader__target {
  display: block;
  margin-top: 0.5rem;
  font-size: 0.75rem;
  color: var(--color-text-muted);
}

.file-uploader__list {
  margin-top: 1rem;
}

.file-uploader__list-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
  font-size: 0.875rem;
  font-weight: 500;
}

.file-uploader__clear {
  padding: 0.25rem 0.5rem;
  background: transparent;
  border: 1px solid var(--color-border);
  border-radius: 4px;
  font-size: 0.75rem;
  cursor: pointer;
}

.file-uploader__item {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem;
  border-radius: 4px;
  font-size: 0.875rem;
}

.file-uploader__item--uploading {
  background: rgba(59, 130, 246, 0.1);
}

.file-uploader__item--complete {
  background: rgba(34, 197, 94, 0.1);
}

.file-uploader__item--error {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
}

.file-uploader__item-name {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.file-uploader__item-status {
  flex-shrink: 0;
  margin-left: 1rem;
  color: var(--color-text-secondary);
}

/* =============================================================================
   FILE EVENT FEED
   ============================================================================= */

.file-event-feed {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.file-event-feed__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  border-bottom: 1px solid var(--color-border);
}

.file-event-feed__title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin: 0;
  font-size: 1rem;
  font-weight: 600;
}

.file-event-feed__status {
  padding: 0.125rem 0.5rem;
  border-radius: 9999px;
  font-size: 0.625rem;
  font-weight: 500;
  text-transform: uppercase;
  background: var(--color-border);
  color: var(--color-text-secondary);
}

.file-event-feed__status--connected {
  background: rgba(34, 197, 94, 0.2);
  color: #22c55e;
}

.file-event-feed__clear {
  padding: 0.25rem 0.5rem;
  background: transparent;
  border: 1px solid var(--color-border);
  border-radius: 4px;
  font-size: 0.75rem;
  cursor: pointer;
}

.file-event-feed__list {
  flex: 1;
  overflow-y: auto;
  padding: 0.5rem;
}

.file-event-feed__empty {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100px;
  color: var(--color-text-secondary);
  font-size: 0.875rem;
}

.file-event-feed__item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem;
  border-radius: 4px;
  font-size: 0.8125rem;
  margin-bottom: 0.25rem;
}

.file-event-feed__item--created {
  background: rgba(34, 197, 94, 0.1);
}

.file-event-feed__item--modified {
  background: rgba(234, 179, 8, 0.1);
}

.file-event-feed__item--deleted {
  background: rgba(239, 68, 68, 0.1);
}

.file-event-feed__item--renamed {
  background: rgba(59, 130, 246, 0.1);
}

.file-event-feed__icon {
  width: 1.5rem;
  text-align: center;
  font-weight: bold;
  font-family: monospace;
}

.file-event-feed__type {
  width: 60px;
  font-size: 0.75rem;
  text-transform: uppercase;
  color: var(--color-text-secondary);
}

.file-event-feed__path {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.file-event-feed__time {
  flex-shrink: 0;
  font-size: 0.75rem;
  color: var(--color-text-secondary);
}

.file-event-feed__footer {
  padding: 0.5rem 1rem;
  border-top: 1px solid var(--color-border);
  font-size: 0.75rem;
  color: var(--color-text-secondary);
  text-align: center;
}

/* =============================================================================
   PROTOCOL BADGES
   ============================================================================= */

.protocol-badges {
  display: flex;
  gap: 0.25rem;
  flex-shrink: 0;
}

.protocol-badges--small .protocol-badge {
  font-size: 0.5625rem;
  padding: 0.0625rem 0.25rem;
}

.protocol-badge {
  padding: 0.125rem 0.375rem;
  border-radius: 9999px;
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
}

.protocol-badge--ftp {
  background: rgba(139, 92, 246, 0.2);
  color: #8b5cf6;
}

.protocol-badge--sftp {
  background: rgba(236, 72, 153, 0.2);
  color: #ec4899;
}

.protocol-badge--http {
  background: rgba(59, 130, 246, 0.2);
  color: #3b82f6;
}

.protocol-badge--s3 {
  background: rgba(249, 115, 22, 0.2);
  color: #f97316;
}

.protocol-badge--smb {
  background: rgba(34, 197, 94, 0.2);
  color: #22c55e;
}

.protocol-badge--nfs {
  background: rgba(234, 179, 8, 0.2);
  color: #eab308;
}

.protocol-badge--nas {
  background: rgba(20, 184, 166, 0.2);
  color: #14b8a6;
}
```

Ensure CSS custom properties exist at root (add if missing):
```css
:root {
  --color-primary: #3b82f6;
  --color-background: #0f172a;
  --color-surface: #1e293b;
  --color-border: #334155;
  --color-text: #f8fafc;
  --color-text-secondary: #94a3b8;
  --color-text-muted: #64748b;
}
```
  </action>
  <verify>
Build and check for CSS errors:
```powershell
cd src/dashboard
npm run build
```
  </verify>
  <done>App.css includes all styles for file browser, tree, uploader, event feed, and protocol badges.</done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build`
2. No TypeScript errors: `npx tsc --noEmit`
3. App renders with tab navigation
4. Files tab shows FileBrowser and FileEventFeed
5. Servers tab continues to work as before
6. Styles are consistent with existing dashboard design
</verification>

<success_criteria>
- Tab navigation switches between Servers and Files views
- FileBrowser shows tree with file operations
- FileEventFeed shows live events with protocol badges
- All components styled consistently with dark theme
- Responsive layout works on smaller screens
</success_criteria>

<output>
After completion, create `.planning/phases/08-file-operations-event-streaming/08-05-SUMMARY.md`
</output>
