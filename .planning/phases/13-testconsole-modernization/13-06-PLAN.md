# Plan 13-06: Playwright E2E tests for all dashboard features

---
wave: 2
depends_on:
  - 13-05-PLAN.md
files_modified:
  - tests/FileSimulator.E2ETests/PageObjects/DashboardPage.cs (new)
  - tests/FileSimulator.E2ETests/PageObjects/ServersPage.cs (new)
  - tests/FileSimulator.E2ETests/PageObjects/FilesPage.cs (new)
  - tests/FileSimulator.E2ETests/PageObjects/KafkaPage.cs (new)
  - tests/FileSimulator.E2ETests/PageObjects/AlertsPage.cs (new)
  - tests/FileSimulator.E2ETests/PageObjects/HistoryPage.cs (new)
  - tests/FileSimulator.E2ETests/Tests/DashboardTests.cs (new)
  - tests/FileSimulator.E2ETests/Tests/ServerManagementTests.cs (new)
  - tests/FileSimulator.E2ETests/Tests/FileOperationsTests.cs (new)
  - tests/FileSimulator.E2ETests/Tests/KafkaTests.cs (new)
  - tests/FileSimulator.E2ETests/Tests/AlertsTests.cs (new)
  - tests/FileSimulator.E2ETests/Tests/HistoryTests.cs (new)
autonomous: true
---

## Objective

Implement comprehensive Playwright E2E tests covering all dashboard features including servers tab, files tab, Kafka tab, alerts tab, and history tab using the Page Object Model pattern.

## Context

The dashboard (src/dashboard) is a React application with these main features:
- Servers tab: Server grid with health status, create/delete dynamic servers
- Files tab: File browser with tree view, upload, download, delete operations
- Kafka tab: Topic list, message producer, message viewer, consumer groups
- Alerts tab: Active alerts list, alert history, alert banner
- History tab: Time range selector, latency charts, server sparklines

Tests should validate user journeys through the UI, not implementation details.

## Tasks

<task id="1">
Create DashboardPage page object.

Create file: tests/FileSimulator.E2ETests/PageObjects/DashboardPage.cs

Implement:
- Constructor taking IPage
- Locators using role-based selectors (GetByRole, GetByLabel)
- Properties:
  - HeaderTitle (heading "File Simulator Suite")
  - ConnectionStatus indicator
  - TabButtons (Servers, Files, Kafka, Alerts, History)
  - SummaryHeader with server counts
- Methods:
  - NavigateAsync(baseUrl) - goto and wait for load
  - WaitForDashboardLoad() - wait for SignalR and initial data
  - SwitchToTab(tabName) - click tab and wait for content
  - GetServerCount() - from summary header
  - GetConnectionStatus() - connected/disconnected
</task>

<task id="2">
Create ServersPage page object.

Create file: tests/FileSimulator.E2ETests/PageObjects/ServersPage.cs

Implement:
- Locators:
  - ServerGrid container
  - ServerCards (individual server cards)
  - CreateServerButton
  - CreateServerModal dialog
  - DeleteConfirmDialog
  - ServerDetailsPanel
- Methods:
  - GetAllServerNames() - list of server names
  - GetServerStatus(name) - status from card
  - GetServerHealth(name) - health indicator status
  - OpenCreateServerDialog()
  - FillServerDetails(name, protocol, username, password)
  - SubmitServerCreation()
  - WaitForServerInList(name, timeout)
  - SelectServer(name) - click to show details
  - DeleteServer(name) - open menu, click delete, confirm
  - GetServerDetails(name) - from details panel
</task>

<task id="3">
Create FilesPage page object.

Create file: tests/FileSimulator.E2ETests/PageObjects/FilesPage.cs

Implement:
- Locators:
  - FileTree component
  - FileUploader (dropzone)
  - BatchOperationsBar
  - FileEventFeed
- Methods:
  - GetFilesInDirectory(path) - expand tree, list files
  - UploadFile(localPath, targetDirectory) - drag-drop or click upload
  - DownloadFile(path) - right-click, download
  - DeleteFile(path) - select, batch delete
  - SelectMultipleFiles(paths) - for batch operations
  - WaitForFileInList(name, timeout)
  - GetRecentEvents() - from event feed
</task>

<task id="4">
Create KafkaPage page object.

Create file: tests/FileSimulator.E2ETests/PageObjects/KafkaPage.cs

Implement:
- Locators:
  - TopicList
  - CreateTopicForm
  - MessageProducer form
  - MessageViewer panel
  - ConsumerGroupDetail
- Methods:
  - GetTopicList() - list of topic names
  - CreateTopic(name, partitions)
  - DeleteTopic(name)
  - SelectTopic(name) - show messages
  - ProduceMessage(topic, key, value)
  - GetMessages(topic, count) - from viewer
  - GetConsumerGroups()
</task>

<task id="5">
Create AlertsPage page object.

Create file: tests/FileSimulator.E2ETests/PageObjects/AlertsPage.cs

Implement:
- Locators:
  - AlertBanner (top of page)
  - AlertsTab content
  - ActiveAlertsList
  - AlertHistoryList
  - AcknowledgeButton
- Methods:
  - GetActiveAlerts() - list with severity, message, time
  - GetAlertBannerText() - if visible
  - AcknowledgeAlert(alertId)
  - DismissAlertBanner()
  - GetAlertHistory()
</task>

<task id="6">
Create HistoryPage page object.

Create file: tests/FileSimulator.E2ETests/PageObjects/HistoryPage.cs

Implement:
- Locators:
  - TimeRangeSelector (1h, 6h, 24h, 7d)
  - LatencyChart
  - ServerSparklines
- Methods:
  - SelectTimeRange(range) - click button
  - GetCurrentTimeRange()
  - WaitForChartLoad() - wait for data
  - GetSparklineServers() - list of servers shown
</task>

<task id="7">
Create DashboardTests test class.

Create file: tests/FileSimulator.E2ETests/Tests/DashboardTests.cs

Tests:
- Dashboard_ShowsAllTabs() - verify 5 tabs visible
- Dashboard_DisplaysServerCount() - summary header shows server count
- Dashboard_ShowsConnectionStatus() - SignalR connected indicator
- Dashboard_TabNavigation_Works() - can switch between all tabs
- Dashboard_ResponsiveLayout() - viewport resize maintains usability
</task>

<task id="8">
Create ServerManagementTests test class.

Create file: tests/FileSimulator.E2ETests/Tests/ServerManagementTests.cs

Tests:
- Servers_DisplaysAllConfiguredServers() - all static servers shown
- Servers_ShowsHealthStatus() - health indicators visible
- Servers_CanViewServerDetails() - click server, see details panel
- Servers_CanCreateDynamicServer() - create FTP server, appears in list
- Servers_CanDeleteDynamicServer() - delete created server, removed from list
- Servers_CreateServerValidation() - empty name shows error

Note: Create/delete tests should clean up after themselves.
</task>

<task id="9">
Create FileOperationsTests test class.

Create file: tests/FileSimulator.E2ETests/Tests/FileOperationsTests.cs

Tests:
- Files_DisplaysFileTree() - tree loads with directories
- Files_CanExpandDirectory() - click folder, shows contents
- Files_CanUploadFile() - upload test file, appears in tree
- Files_CanDownloadFile() - download file (verify download triggered)
- Files_CanDeleteFile() - delete uploaded file, removed from tree
- Files_ShowsRealtimeEvents() - event feed updates on file operations
- Files_BatchOperations() - select multiple, batch delete

Create test file in temp directory for upload tests.
</task>

<task id="10">
Create KafkaTests test class.

Create file: tests/FileSimulator.E2ETests/Tests/KafkaTests.cs

Tests:
- Kafka_DisplaysTopicList() - topics visible
- Kafka_CanCreateTopic() - create topic, appears in list
- Kafka_CanDeleteTopic() - delete topic, removed from list
- Kafka_CanProduceMessage() - send message via producer
- Kafka_CanViewMessages() - messages appear in viewer
- Kafka_ShowsConsumerGroups() - consumer groups section visible

Clean up test topics after tests.
</task>

<task id="11">
Create AlertsTests test class.

Create file: tests/FileSimulator.E2ETests/Tests/AlertsTests.cs

Tests:
- Alerts_TabDisplaysCorrectly() - alerts tab loads
- Alerts_ShowsActiveAlerts() - if alerts exist, list shows them
- Alerts_BannerAppearsForCritical() - critical alert shows banner (may need to trigger)
- Alerts_CanDismissBanner() - dismiss button works
- Alerts_ShowsAlertHistory() - history section visible

Note: Alert tests may need to trigger alerts via API or verify existing behavior.
</task>

<task id="12">
Create HistoryTests test class.

Create file: tests/FileSimulator.E2ETests/Tests/HistoryTests.cs

Tests:
- History_DisplaysTimeRangeSelector() - time range buttons visible
- History_CanChangeTimeRange() - clicking changes displayed range
- History_ShowsLatencyChart() - chart renders
- History_ShowsServerSparklines() - sparklines for servers visible
- History_LoadsDataForRange() - switching range updates chart data
</task>

## Verification

```powershell
# Build E2E tests
cd C:\Users\UserC\source\repos\file-simulator-suite\tests\FileSimulator.E2ETests
dotnet build

# Run all E2E tests (requires simulator running)
$env:USE_EXISTING_SIMULATOR = "true"
dotnet test

# Run specific test class
dotnet test --filter "FullyQualifiedName~DashboardTests"
dotnet test --filter "FullyQualifiedName~ServerManagementTests"
dotnet test --filter "FullyQualifiedName~FileOperationsTests"
dotnet test --filter "FullyQualifiedName~KafkaTests"
dotnet test --filter "FullyQualifiedName~AlertsTests"
dotnet test --filter "FullyQualifiedName~HistoryTests"

# Run with headed browser for debugging
$env:PWDEBUG = "1"
dotnet test --filter "FullyQualifiedName~DashboardTests"

# Expected: All tests pass
# Each test class covers its respective dashboard tab
```

## must_haves

These criteria must be TRUE for the plan to be considered complete:

1. Page objects created for all dashboard tabs (Dashboard, Servers, Files, Kafka, Alerts, History)
2. Page objects use role-based selectors (GetByRole, GetByLabel) not CSS classes
3. DashboardTests verify tab navigation and summary header
4. ServerManagementTests verify server display, create, and delete
5. FileOperationsTests verify upload, download, delete, and event feed
6. KafkaTests verify topic management and message produce/consume
7. AlertsTests verify alert display and banner behavior
8. HistoryTests verify time range selection and chart display
9. All tests clean up resources they create (dynamic servers, topics, files)
10. Tests pass when run against running simulator
