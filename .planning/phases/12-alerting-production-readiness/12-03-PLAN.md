# Phase 12 Plan 03: Dashboard Alert UI - Toast Notifications and Banner

## Goal
Integrate Sonner toast notifications for new alerts and create persistent alert banner for unresolved alerts in dashboard.

## Scope

### Files to Create
- `src/dashboard/src/types/alert.ts` - Alert TypeScript types
- `src/dashboard/src/hooks/useAlertStream.ts` - SignalR alert subscription hook
- `src/dashboard/src/hooks/useAlerts.ts` - Alert state management hook
- `src/dashboard/src/components/AlertBanner.tsx` - Persistent unresolved alert banner
- `src/dashboard/src/components/AlertToaster.tsx` - Sonner toast wrapper component

### Files to Modify
- `src/dashboard/package.json` - Add sonner package
- `src/dashboard/src/App.tsx` - Add AlertToaster and AlertBanner components
- `src/dashboard/src/App.css` - Add alert banner styling

## Tasks

### Task 1: Install Sonner Package
- [ ] Run: `npm install sonner --prefix src/dashboard`
- [ ] Verify package added to package.json dependencies (version ~1.7.x)
- [ ] Run: `npm install --prefix src/dashboard` to update package-lock.json

### Task 2: Create Alert TypeScript Types
- [ ] Create `src/dashboard/src/types/alert.ts`
- [ ] Export AlertSeverity type: "Info" | "Warning" | "Critical"
- [ ] Export Alert interface: id (string), type (string), severity (AlertSeverity), title (string), message (string), source (string), triggeredAt (string - ISO date), resolvedAt (string | null), isResolved (boolean)
- [ ] Export AlertStats interface: totalCount (number), infoCount (number), warningCount (number), criticalCount (number), byType (Record<string, number>)

### Task 3: Create Alert SignalR Hook
- [ ] Create `src/dashboard/src/hooks/useAlertStream.ts`
- [ ] Use existing useSignalR hook to connect to /hubs/alerts
- [ ] Define callback handlers: onAlertTriggered (alert: Alert), onAlertResolved (alert: Alert)
- [ ] Subscribe to "AlertTriggered" and "AlertResolved" events in useEffect
- [ ] Return connection state and unsubscribe function
- [ ] Follow pattern from existing useServerStatus.ts hook

### Task 4: Create Alert State Management Hook
- [ ] Create `src/dashboard/src/hooks/useAlerts.ts`
- [ ] Use useState for activeAlerts (Alert[]) and alertHistory (Alert[])
- [ ] Use useAlertStream to receive real-time alert events
- [ ] On AlertTriggered: add to activeAlerts and alertHistory, call showToast()
- [ ] On AlertResolved: remove from activeAlerts, update in alertHistory
- [ ] Implement fetchActiveAlerts(): GET /api/alerts/active
- [ ] Implement fetchAlertHistory(): GET /api/alerts/history
- [ ] Implement fetchAlertStats(): GET /api/alerts/stats
- [ ] Call fetchActiveAlerts and fetchAlertHistory on mount
- [ ] Return: activeAlerts, alertHistory, stats, loading state, error state

### Task 5: Create Toast Notification Component
- [ ] Create `src/dashboard/src/components/AlertToaster.tsx`
- [ ] Import Toaster from sonner and Alert type
- [ ] Export AlertToaster component: wraps Toaster with position="bottom-right", richColors, closeButton, visibleToasts=5
- [ ] Export showAlert function: accepts Alert, determines duration based on severity
- [ ] Severity durations: Info=5000ms, Warning=10000ms, Critical=Infinity
- [ ] Map severity to toast method: Info -> toast.info(), Warning -> toast.warning(), Critical -> toast.error()
- [ ] For Critical: add action button {label: 'Dismiss', onClick: () => {}}
- [ ] Pass title and description (message) to toast
- [ ] No sound configuration (visual only per CONTEXT.md)

### Task 6: Create Alert Banner Component
- [ ] Create `src/dashboard/src/components/AlertBanner.tsx`
- [ ] Accept props: alerts (Alert[])
- [ ] If no unresolved alerts, return null (banner hidden)
- [ ] Group alerts by severity: count Critical, Warning, Info
- [ ] Display banner at top of app with severity counts
- [ ] Style with BEM: .alert-banner (container), .alert-banner__count (severity badges), .alert-banner__message (text)
- [ ] Color code by highest severity: red for Critical, orange for Warning, blue for Info
- [ ] Add dismiss button to hide banner temporarily (use localStorage to persist dismiss)
- [ ] Add "View All" link that navigates to Alerts tab (when implemented in Plan 04)

### Task 7: Integrate into App.tsx
- [ ] Import useAlerts hook at top of App component
- [ ] Call const { activeAlerts, alertHistory, stats } = useAlerts()
- [ ] Import and render AlertToaster component at root level (before all other UI)
- [ ] Import and render AlertBanner component at top of main content (after header, before tabs)
- [ ] Pass activeAlerts to AlertBanner: <AlertBanner alerts={activeAlerts} />
- [ ] Ensure AlertToaster is always rendered (handles global toast state)

### Task 8: Add Alert Banner CSS
- [ ] Add to `src/dashboard/src/App.css`
- [ ] .alert-banner: position sticky, top: 60px (below header), z-index: 90, background gradient, padding, border-bottom, animation slide-in
- [ ] .alert-banner__content: display flex, justify-content space-between, align-items center
- [ ] .alert-banner__counts: display flex, gap: 1rem
- [ ] .alert-banner__count: padding, border-radius, font-weight bold, white-space nowrap
- [ ] .alert-banner__count--critical: background red, color white
- [ ] .alert-banner__count--warning: background orange, color white
- [ ] .alert-banner__count--info: background blue, color white
- [ ] .alert-banner__actions: display flex, gap: 0.5rem
- [ ] .alert-banner__dismiss: button styling with hover effect

## Verification
```bash
# Check package installed
cat src/dashboard/package.json | grep sonner

# Build dashboard
cd src/dashboard && npm run build

# Check bundle size (should add ~2-3KB for sonner)
ls -lh src/dashboard/dist/assets/*.js | tail -5
```

## Success Criteria
- [ ] sonner package installed in dashboard package.json
- [ ] alert.ts defines Alert and AlertSeverity types matching backend models
- [ ] useAlertStream subscribes to AlertTriggered and AlertResolved SignalR events
- [ ] useAlerts manages activeAlerts and alertHistory state with real-time updates
- [ ] AlertToaster wraps Sonner with bottom-right position and rich colors
- [ ] showAlert function maps severity to correct toast method with duration
- [ ] Info toasts disappear after 5 seconds
- [ ] Warning toasts disappear after 10 seconds
- [ ] Critical toasts remain until dismissed
- [ ] AlertBanner displays at top showing unresolved alert counts
- [ ] AlertBanner hidden when no unresolved alerts
- [ ] AlertBanner styled with severity colors (red/orange/blue)
- [ ] App.tsx renders AlertToaster globally and AlertBanner at top of content
- [ ] CSS provides sticky positioning and smooth animations

## Commit
```bash
git add src/dashboard
git commit -m "feat(12-03): add alert toast notifications and banner

- Add Sonner package for lightweight toast notifications (2-3KB)
- Add alert TypeScript types and SignalR subscription hook
- Add useAlerts hook for alert state management
- Add AlertToaster with severity-based durations (Info=5s, Warning=10s, Critical=âˆž)
- Add AlertBanner showing unresolved alert counts at top of dashboard
- Integrate AlertToaster and AlertBanner into App.tsx
- Add CSS styling for alert banner with severity colors

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"
```
